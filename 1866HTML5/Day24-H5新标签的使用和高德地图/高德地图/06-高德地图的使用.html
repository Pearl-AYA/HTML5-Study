<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>é«˜å¾·åœ°å›¾çš„ä½¿ç”¨</title>
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<style type="text/css">
			*{
				padding: 0;
				margin: 0;
			}
			#container{
				width: 100%;
				height: 500px;
				background-color: pink;
			}
		</style>
		<!--ä½¿ç”¨JQåº“-->
		<script src="lib/jquery.js" type="text/javascript"></script>
		<!--åœ¨é¡µé¢ä¸­å¼•å…¥é«˜å¾·åœ°å›¾JavaScript APIå…¥å£è„šæœ¬-->
		<script src="http://webapi.amap.com/maps?v=1.3&key=ada703346050dddedbfa41cd0314ec04" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<!--åˆ›å»ºåœ°å›¾çš„å®¹å™¨ï¼Œä¸€å®šè¦ç»™id-->
		<div id="container"></div>
		<div class="fenye">
			<a href="###" class="start">é¦–é¡µ</a>
			<a href="###" class="prev"><<ä¸Šä¸€é¡µ</a>
			<!--ä¸ºäº†çµæ´»åœ°å†³å®šè¿™é‡Œçš„aæ ‡ç­¾çš„ä¸ªæ•°ï¼Œé‡‡ç”¨åŠ¨æ€æ·»åŠ çš„æ–¹å¼-->
			<!--<a href="###" name="p" style="background-color: orange;color: #FFFFFF;">1</a>
			<a href="###" name="p">2</a>
			<a href="###" name="p">3</a>
			<a href="###" name="p">4</a>
			<a href="###" name="p">5</a>-->
			<a href="###" class="next">ä¸‹ä¸€é¡µ>></a>
			<a href="###" class="end">å°¾é¡µ</a>
		</div>
	</body>
	<script type="text/javascript">
		// åˆ›å»ºåœ°å›¾å¯¹è±¡
		var map = new AMap.Map('container', {
			zoom: 10, //ç¼©æ”¾10å€
			center: [116.39, 39.9]
		})
		//========================
		// åˆ›å»ºæ ‡è®°(å…ˆå•ç‹¬åˆ›å»ºä¸€ä¸ªæ ‡è®°çœ‹ä¸€ä¸‹æ•ˆæœï¼Œç„¶åæ‰¹é‡åˆ›å»º)
		/*var marker = new AMap.Marker({
			position: [116.480983, 39.989628], // æŒ‡å®šmarkeræ‰€åœ¨çš„ä½ç½®
			//åœ¨åˆ›å»ºçš„æ—¶å€™ç›´æ¥èµ‹äºˆmapå±æ€§å€¼ï¼Œå³åœ¨ä¸Šé¢çš„mapåœ°å›¾ä¸­åˆ›å»ºmarker
			// positionå°±æ˜¯markerçš„å…·ä½“çš„ä½ç½®
			//map_longitudeï¼šç»åº¦ï¼›map_latitudeï¼šçº¬åº¦
			map: map
		})*/
		//=========================
		// å­˜å‚¨markerçš„æ•°ç»„
		var markerArr = []
		// æ€»é¡µæ•°
		var pageCount = 0
		// å½“å‰é¡µç é»˜è®¤ä¸º1
		var currentPageNo = 1
		// ä»»åŠ¡1ï¼šè®¡ç®—æœ‰å¤šå°‘é¡µ(ä»¥ä¾¿åˆå§‹åŒ–æŒ‰é’®)
		function initBtn(){
			// é€šè¿‡jQçš„getJSONæ–¹æ³•è·å–æ•°æ®
			// å‚æ•°2ï¼šæ˜¯è¿åŒè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼Œnullå³æ— 
			$.getJSON("data/1.json", null, function(resultData){
				// resultDataæ˜¯è§£æå‡ºæ¥çš„Jsonå¯¹è±¡
				//console.log(resultData)
				
				pageCount = resultData.page_count
				// é¡µç æ•°(é¡µç æŒ‰é’®ä¸ªæ•°) = å‘ä¸Šå–æ•´(æ•°æ®æ€»æ•° / æ¯é¡µæ¡ç›®) (é»˜è®¤5æ¡)
				for(var i = pageCount; i >= 1; i--){
					// åŠ¨æ€åˆ›å»ºé¡µç æŒ‰é’®
					var $a = $('<a href="###" name="p">' + i +  '</a>')
					if(i == 1){
						$a.css({
							background: 'orange',
							color: '#fff'
						})
					}
					$('.prev').after($a)
				}
				// ç»™æ‰€æœ‰çš„æŒ‰é’®ç»‘å®šäº‹ä»¶
				$('.fenye a').on('click', fenyeFn)
				// é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€é¡µçš„æ•°æ®
				showData(currentPageNo)
			})
		}
		// å‡½æ•°è°ƒç”¨
		initBtn()
		// æ„å»ºæŸä¸€é¡µçš„æ•°æ®  pageNo = 3
		function showData(pageNo){
			$.getJSON('data/' + pageNo + '.json', null, function(resultData){
				//console.log(resultData)
				if(markerArr.length > 0){
					for(var index in resultData.shop_data){
						//console.log(index)
						markerArr[index].setPosition([resultData.shop_data[index].map_longitude,
						resultData.shop_data[index].map_latitude])
					}
					//æ¯æ¬¡ä¿®æ”¹ä¸‹åœ°å›¾çš„ä¸­å¿ƒç‚¹(ä»¥ç¬¬0ä¸ªå…ƒç´ ä¸ºä¸­å¿ƒç‚¹)
					map.setCenter([markerArr[0].getPosition().lng,
						markerArr[0].getPosition().lat])
				}else{
					// markerArrä¸ºç©ºæ•°ç»„
					for(let tempObj of resultData.shop_data){
						//console.log(tempObj)
						// åˆ›å»ºmarkerå¯¹è±¡
						var marker = new AMap.Marker({
							// è¿™é‡Œæœ€å¥½parseFloat()å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæµ®ç‚¹æ•°
							position: [parseFloat(tempObj.map_longitude), 
								parseFloat(tempObj.map_latitude)],
							//æŒ‡å®šæ ‡è®°ç‰©è®¾ç½®åˆ°å“ªä¸ªåœ°å›¾ä¸­å»
							map: map
						})
						// ç»‘å®šå•å‡»äº‹ä»¶ï¼Œmarkerä¸€æ—¦è¢«ç‚¹å‡»åˆ™å¼¹å‡ºçª—ä½“ä¿¡æ¯
						marker.on('click', function(){
							// æ‰“å¼€çª—ä½“ä¿¡æ¯
							openInfo(tempObj);
						})
						// é€šè¿‡ç¬¬ä¸€æ¬¡åˆ›å»ºä¹‹åï¼ŒæŠŠæ ‡è®°å­˜æ”¾åˆ°æ•°ç»„ä¸­
						markerArr.push(marker)
						console.log("ğŸğŸ")
					}
				}
			})
		}
		// ä»»åŠ¡2ï¼šåˆ†é¡µæŒ‰é’®ç‚¹å‡»é€»è¾‘
		function fenyeFn(){
			// å¾—åˆ°å…ƒç´ çš„htmlçš„å€¼
			//console.log("æŒ‰é’®ä¸Šçš„æ–‡å­—æ˜¯ï¼š" + $(this).html())
			// 1ã€å¤„ç†é¡µç æ•°çš„é€»è¾‘ï¼šç‚¹å‡»åï¼ŒcurrentPageNoçš„å€¼è¢«æ”¹å˜äº†
			switch($(this).html()){
				case 'é¦–é¡µ':
					currentPageNo = 1
					break
				case '&lt;&lt;ä¸Šä¸€é¡µ':
					currentPageNo--
					break
				case 'ä¸‹ä¸€é¡µ&gt;&gt;':
					currentPageNo++
					break
				case 'å°¾é¡µ':
					currentPageNo = pageCount
					break
				default:
					currentPageNo = parseInt($(this).html())
					break
			}
			//console.log("å½“å‰é¡µæ˜¯ï¼š" + currentPageNo)
			//===========================
			//2ã€é¦–å°¾ã€ä¸Šä¸‹æŒ‰é’®çš„éšè—æ˜¾ç¤ºé€»è¾‘
			if(currentPageNo == 1){
				$('.start').css('display', 'none')
				$('.prev').css('display', 'none')
			}else{
				$('.start').css('display', 'inline-block')
				$('.prev').css('display', 'inline-block')
			}
			// å¦‚æœæ˜¯æœ€åä¸€é¡µ
			if(currentPageNo == pageCount){
				$('.end').css('display', 'none')
				$('.next').css('display', 'none')
			}else{
				$('.end').css('display', 'inline-block')
				$('.next').css('display', 'inline-block')
			}
			// 3ã€å¤„ç†æŒ‰é’®é¢œè‰²çš„é€»è¾‘
			//è·å–å…¨éƒ¨é¡µç æŒ‰é’®çš„æ•°ç»„
			var $pageBtn = $('[name=p]')
			//å…ˆæŠŠè¿™å‡ ä¸ªæŒ‰é’®çš„æ ·å¼è¿˜åŸæˆé»˜è®¤
			$pageBtn.css({
				background: "pink",
				color: "#999"
			})
			// ç„¶åå†å¤„ç†å½“å‰é¡µç æ•°å¯¹åº”çš„æŒ‰é’®æ ·å¼
			$pageBtn[currentPageNo - 1].style.background = 'orange'
			$pageBtn[currentPageNo - 1].style.color = '#fff'
			// åˆ·æ–°æ•°æ®
			showData(currentPageNo)
		}
		// æ‰“å¼€çª—ä½“ä¿¡æ¯
		function openInfo(shopObj){
			var info = []
			info.push("<div><div><img style=\"float:left;\" src=\"" + 
				shopObj.shop_ico + "\"/></div>");
			info.push("<div style=\"padding:0px 0px 0px 4px;\"><b>" + 
			shopObj.shop_name + "</b>");
			info.push("ç”µè¯ï¼š010-84107000 é‚®ç¼–ï¼š10001");
			info.push("åœ°å€ï¼šåŒ—äº¬å¸‚æœé˜³åŒºç‹äº•åºœ10å·æ‰‹æŠ–å¹¿åœº4å±‚</div></div>");
			// åˆ›å»ºçª—ä½“å¯¹è±¡
			infoWindow = new AMap.InfoWindow({
				// ä½¿ç”¨é»˜è®¤çš„ä¿¡æ¯çª—ä½“æ¡†æ ·å¼ï¼Œæ˜¾ç¤ºä¿¡æ¯å†…å®¹
				// ä¿¡æ¯ä½¿ç”¨æ¢è¡Œç¬¦è¿æ¥
				content: info.join("<br/>")
			})
			// ä½¿ç”¨infoWindowå¯¹è±¡æ‰“å¼€çª—å£
			infoWindow.open(map, [shopObj.map_longitude,
				+shopObj.map_latitude + 0.02])
		}
	</script>
</html>
