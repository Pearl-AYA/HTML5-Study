<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Canvasä½ ç”»æˆ‘çŒœæ•ˆæœ</title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
			}
			#box{
				width: 600px;
				height: 500px;
				margin: 100px auto;
				border: 1px solid blue;
			}
			#box .control{
				height: 100px;
			}
			#box .control div{
				height: 50px;
				line-height: 50px;
			}
			#box .control .changeColor{
				padding-left: 60px;
			}
			#box .control .changeColor input{
				width: 30px;
				height: 30px;
				margin: 0 15px;
				font-size: 0;
				/*background-color: red;*/
				vertical-align: middle;
			}
			#box .control .changeColor input:nth-of-type(1){
				background-color: black;	
			}
			#box .control .changeColor input:nth-of-type(2){
				background-color: pink;	
			}
			#box .control .changeColor input:nth-of-type(3){
				background-color: red;
			}
			#box .control .changeColor input:nth-of-type(4){
				background-color: orange;	
			}
			#box .control .changeColor input:nth-of-type(5){
				background-color: brown;	
			}
			#box .control .changeColor input:nth-of-type(6){
				background-color: purple;	
			}
			#box .control .clear{
				height: 50px;
			}
			#box .control .clear input{
				width: 100px;
				height: 50px;
				margin: 0 15px;
				font-size: 20px;
				background-color: #FCF3DF;
			}
			#box .control .clear input:nth-of-type(1){
				margin-left: 100px;
			}
			b{
				font-size: 20px;
			}
			#canvas{
				background-color: #FEE7BF;
			}
		</style>
	</head>
	<body>
		<div id="box">
			<div class="control">
				<div class="changeColor">
					é€‰æ‹©ç”»ç¬”é¢œè‰²ï¼š<input type="button" value="é»‘è‰²"/>
					<input type="button" value="ç²‰è‰²"/>
					<input type="button" value="çº¢è‰²"/>
					<input type="button" value="ğŸŠè‰²"/>
					<input type="button" value="æ£•è‰²"/>
					<input type="button" value="ç´«è‰²"/>
				</div>
				<div class="clear">
					<input type="button" value="æ¸…ç©ºç”»å¸ƒ" id="clearAllBtn"/>
					å½“å‰é€‰ä¸­çš„é¢œè‰²ï¼š<b>é»‘è‰²</b>
					<input type="button" value="æ©¡çš®æª«" id="eraserBtn"/>
				</div>
			</div>
			<canvas id="canvas" width="600" height="400"></canvas>
		</div>
	</body>
	<script type="text/javascript">
		//æ‰¾åˆ°canvasç”»å¸ƒ
		var cvs = document.querySelector("#canvas")
		// å…¨å±€çš„å˜é‡ctx(ç”»ç¬”)
		var ctx = cvs.getContext("2d")
		
		// æ‰¾åˆ°ã€é¢œè‰²buttonæ•°ç»„ã€‘
		var colorBtns = document.querySelectorAll('.changeColor input')
		// æ‰¾åˆ°æ©¡çš®æª«
		var eraserBtn = document.querySelector("#eraserBtn")
		// æ‰¾åˆ°ã€æ¸…ç©ºç”»å¸ƒã€‘æŒ‰é’®
		var clearAllBtn = document.querySelector("#clearAllBtn")
		/**
		 * éå†é¢œè‰²buttonï¼Œç»‘å®šç‚¹å‡»äº‹ä»¶. ä¸€æ—¦è¢«ç‚¹å‡»ï¼Œå°±æ‰§è¡ŒchangeColoræ–¹æ³•
		 */
		for (var i = 0; i < colorBtns.length; i++) {
			colorBtns[i].onclick = changeColor;
		}
		// åŠŸèƒ½1ï¼šæ”¹å˜ç”»ç¬”çš„é¢œè‰²/æ”¹å˜bæ ‡ç­¾çš„é¢œè‰²å’Œæ–‡å­—
		function changeColor(){
			//è®¾ç½®ç”»ç¬”çš„çº¿çš„é£æ ¼
			ctx.strokeStyle = getComputedStyle(this, null).backgroundColor;
			// æ‰¾åˆ°bæ ‡ç­¾
			var b = document.querySelector("b")
			// è®¾ç½®bæ ‡ç­¾çš„é¢œè‰²ä¸ºctx.strokeStyleå’Œæ”¹å˜bæ ‡ç­¾çš„æ–‡å­—
			b.style.color = ctx.strokeStyle
			// è®¾ç½®bæ ‡ç­¾çš„innerHTML
			b.innerHTML = this.value
			// ç¦ç”¨æ©¡çš®æª«åŠŸèƒ½
			isEraser = false
		}
		// å®šä¹‰ä¸€ä¸ªå…¨å±€ç©ºå¯¹è±¡ï¼šç”¨äºè®°å½•åæ ‡å€¼
		var pointerObj = {
			//ç­‰å¾…åŠ¨æ€æ·»åŠ å±æ€§xå’Œy
		}
		// åˆ‡æ¢æ©¡çš®æª«çŠ¶æ€
		var isEraser = false
		//==================
		// åŠŸèƒ½2ï¼šç›‘å¬æŒ‰ä¸‹äº‹ä»¶
		cvs.addEventListener('mousedown', function(event){
			var x = event.offsetX
			var y = event.offsetY
			// ç‚¹å‡»çš„ä½ç½®åæ ‡
			//console.log(x + ":" + y)
			
			//åˆšæŒ‰ä¸‹çš„æ—¶å€™ï¼Œå³åˆ»ç”Ÿæˆ2ä¸ªå±æ€§xå’Œyå¹¶ç”¨äºå­˜å‚¨æŒ‰ä¸‹çš„åæ ‡ç‚¹
			pointerObj.x = x
			pointerObj.y = y
			// å¦‚æœæ©¡çš®æª«è¢«æ¿€æ´»
			if(isEraser){
				//æ‰§è¡Œæ©¡çš®æª«åŠŸèƒ½
				eraserFn(x,y)
			}else{
				//ç”»ç”»åŠŸèƒ½
				draw(x,y)
			}
			/**
			 * ç›‘å¬ç§»åŠ¨å’ŒæŠ¬èµ·
			 */
			this.addEventListener("mousemove", move)
			document.addEventListener("mouseup", up)
		})
		// åŠŸèƒ½3ï¼šç”»ç”»åŠŸèƒ½
		function draw(x,y){
			ctx.beginPath()
			ctx.lineWidth = 5
			// è®¾ç½®ç¬”å¤´æ ·å¼ä¸ºã€åœ†å¤´ã€‘
			ctx.lineCap = "round"
			//ä»xã€yç‚¹å¼€å§‹
			ctx.moveTo(x,y)
			//ç»è¿‡ç‚¹
			ctx.lineTo(pointerObj.x,pointerObj.y)
			//æ‰§è¡Œç»˜åˆ¶æ“ä½œ
			ctx.stroke()
			//å…³é—­è·¯å¾„
			ctx.closePath()
		}
		// åŠŸèƒ½4ï¼šç§»åŠ¨
		function move(e){
			var x = e.offsetX
			var y = e.offsetY
			//console.log(x + " : " + y)
			// å¦‚æœæ©¡çš®æª«è¢«æ¿€æ´»
			if(isEraser){
				//æ‰§è¡Œæ©¡çš®æª«åŠŸèƒ½
				eraserFn(x,y)
			}else{
				//ç”»ç”»åŠŸèƒ½
				draw(x,y)
			}
			// åœ¨ç§»åŠ¨çš„æ—¶å€™æŠŠã€ä¹‹å‰çš„åæ ‡ä½ç½®ã€‘å­˜å‚¨èµ·æ¥
			pointerObj.x = x
			pointerObj.y = y
		}
		// åŠŸèƒ½5ï¼šæŠ¬èµ·
		function up(){
			//cvsç§»é™¤é¼ æ ‡ç§»åŠ¨çš„ç›‘å¬
			cvs.removeEventListener('mousemove', move)
		}
		// åŠŸèƒ½6ï¼šæ©¡çš®æª«åŠŸèƒ½
		function eraserFn(x, y){
			// å¼€å§‹è·¯å¾„
			ctx.beginPath()
			// è£å‰ªä¹‹å‰å…ˆè®¾ç½®ä¿å­˜åœºæ™¯çš„åŸæœ¬(å¾…æ¢å¤çš„åŸæœ¬)
			ctx.save()
			//è£å‰ªåŒºåŸŸï¼š
			ctx.arc(x,y,20, 0, Math.PI * 2, false)
			// è£å‰ªå‡ºä¸€ä¸ªåœ†(æ­¤æ—¶çš„åœ†ä¸­å¯èƒ½æœ‰å†…å®¹)
			ctx.clip()
			// åœ¨è£å‰ªä¹‹åç”»ä¸€ä¸ªã€æ¸…ç©ºçŸ©å½¢ã€‘è¿™ä¸ªçŸ©å½¢å ç”»å¸ƒçš„å…¨éƒ¨åŒºåŸŸ
			// ä½†æ˜¯æ ¹æ®ã€è£å‰ªçš„åŸç†ã€‘è¯¥æ¸…ç©ºçŸ©å½¢åªæœ‰åœ¨ä¸Šé¢çš„è£å‰ªåŒºåŸŸæ‰ç”Ÿæ•ˆ
			// å³ä¼šæŠŠä¸Šé¢è£å‰ªå‡ºçš„åœ†ä¸­çš„å†…å®¹æ¸…ç©º
			ctx.clearRect(0,0,cvs.width,cvs.height)
			// ç„¶åå†è¿˜åŸä¹‹å‰çš„åœºæ™¯(è£å‰ªå‡ºæ¥çš„åŒºåŸŸä¸ä¼šè¿˜åŸï¼Œä¿æŒæ¸…ç©ºçŠ¶æ€)
			// å¦‚æœctxä¸­åŸæ¥æœ‰æ•°æ®ï¼Œåˆ™ä¼šè¢«æ¢å¤å‡ºæ¥ã€‚å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ™æ¢å¤ä¸€ä¸ª
			//ç©ºçš„åŠŸèƒ½å®Œæ•´çš„ç”»å¸ƒã€‚æ¢å¤å‡ºæ¥ä¹‹åç”»çš„æ•°æ®è·Ÿè£å‰ªæ²¡æœ‰å…³ç³»äº†ã€‚
			ctx.restore()
			// å…³é—­è·¯å¾„
			ctx.closePath()
		}
		//åŠŸèƒ½7ï¼šç‚¹å‡»æ©¡çš®æª«æŒ‰é’®,æ¿€æ´»æ©¡çš®æª«
		eraserBtn.onclick = function(){
			// å¼€å¯æ©¡çš®æª«åŠŸèƒ½
			isEraser = true
		}
		// åŠŸèƒ½8ï¼šå…¨éƒ¨æ¸…ç©º
		clearAllBtn.onclick = function(){
			ctx.clearRect(0,0,cvs.width,cvs.height)
		}
	</script>
</html>
