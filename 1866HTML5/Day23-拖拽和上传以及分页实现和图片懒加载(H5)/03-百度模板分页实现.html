<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>åŸç”Ÿåˆ†é¡µå®ç°</title>
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<script src="lib/jquery.js" type="text/javascript"></script>
		<script src="lib/baiduTemplate.js" type="text/javascript"></script>
	</head>
	<body>
		<table id="my_table" border="1px">
			<thead>
				<tr>
					<th>å§“å</th>
					<th>æ€§åˆ«</th>
					<th>å¹´é¾„</th>
					<th>ä½å€</th>
				</tr>
			</thead>
			<tbody>
				<!--<tr>
					<td>éšè¡Œè€…</td>
					<td>ç”·</td>
					<td>18</td>
					<td>å¹¿å·é»„åŸ”åŒº</td>
				</tr>
				<tr>
					<td>éšè¡Œè€…</td>
					<td>ç”·</td>
					<td>19</td>
					<td>å¹¿å·é»„åŸ”åŒº</td>
				</tr>
				<tr>
					<td>éšè¡Œè€…</td>
					<td>ç”·</td>
					<td>20</td>
					<td>å¹¿å·é»„åŸ”åŒº</td>
				</tr>
				<tr>
					<td>éšè¡Œè€…</td>
					<td>ç”·</td>
					<td>21</td>
					<td>å¹¿å·é»„åŸ”åŒº</td>
				</tr>
				<tr>
					<td>éšè¡Œè€…</td>
					<td>ç”·</td>
					<td>22</td>
					<td>å¹¿å·é»„åŸ”åŒº</td>
				</tr>-->
			</tbody>
		</table>
		<!--================-->
		<!--ä¸Šé¢æ˜¯è¡¨å•éƒ¨åˆ†ï¼Œä¸‹é¢æ˜¯åˆ†é¡µæ§åˆ¶éƒ¨åˆ†-->
		<div class="fenye">
			<a href="###" class="start">é¦–é¡µ</a>
			<a href="###" class="prev"><<ä¸Šä¸€é¡µ</a>
			<!--ä¸ºäº†çµæ´»åœ°å†³å®šè¿™é‡Œçš„aæ ‡ç­¾çš„ä¸ªæ•°ï¼Œé‡‡ç”¨åŠ¨æ€æ·»åŠ çš„æ–¹å¼-->
			<!--<a href="###" name="p" style="background-color: orange;color: #FFFFFF;">1</a>
			<a href="###" name="p">2</a>
			<a href="###" name="p">3</a>
			<a href="###" name="p">4</a>
			<a href="###" name="p">5</a>-->
			
			<a href="###" class="next">ä¸‹ä¸€é¡µ>></a>
			<a href="###" class="end">å°¾é¡µ</a>
		</div>
		<!--ã€ğŸ·ã€‘åœ¨è¿™é‡Œä½¿ç”¨scriptæ ‡ç­¾æ¥å®šä¹‰æ¨¡æ¿-->
		<!--æˆ‘ä»¬éœ€è¦ç»™æ¨¡æ¿å®šä¹‰ä¸€ä¸ªidï¼Œæ–¹ä¾¿è®©baiduæ¨¡æ¿é‡Œçš„æ–¹æ³•æ‰¾åˆ°å®ƒ-->
		<!--æˆ‘ä»¬å¦‚æœåœ¨è¿™ä¸ªé‡Œé¢æƒ³è¦è¯†åˆ«JSçš„è¯ï¼Œéœ€è¦ç”¨<% %>æŠŠä»£ç æ‹¬èµ·æ¥ï¼Œæ–¹å¯è¯†åˆ«-->
		<!--æˆ‘ä»¬ä½¿ç”¨<%= %>æ¥è¿›è¡Œè¾“å‡º-->
		<script type="text/template" id="person_tpl">
			 <% for(var tempPerson of arr){ %>
				<tr>
					<td><%= tempPerson.name %></td>
					<td><%= tempPerson.sex %></td>
					<td><%= tempPerson.age %></td>
					<td><%= tempPerson.addr %></td>
				</tr>
			<% } %>
		</script>
		<script type="text/template" id="pageBtns_tpl">
			<% for(var i = 1; i <= count; i++){ %>
				<% if(i == 1){ %>
					<a href="###" name="p" style="background:orange;color:#fff;"><%= i %></a>
				<% }else{ %>
					<a href="###" name="p"><%= i %></a>
				<% } %>
			<% } %>
		</script>
	</body>
	<script type="text/javascript">
		/**
		 * ã€åŸç”Ÿåˆ†é¡µå®ç°çš„æ€è·¯(åŸç†)ã€‘é¦–å…ˆå’Œäº§å“ç»ç†ç¡®å®šä¸€ä¸‹æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®
		 * ç„¶åé€šè¿‡åå¤©çš„æ•°æ®æ¥å£è·å–æŸä¸€é¡µçš„æ•°æ®(åˆ°åº•ç¬¬å“ªä¸€é¡µéœ€è¦ç»™è¿™ä¸ªæ¥å£)
		 * ä¼ å…¥ä¸€ä¸ªè¡¨ç¤ºé¡µç çš„å‚æ•°ã€‚ç„¶åè€ƒè™‘å¦‚ä½•æ˜¾ç¤ºæ•°æ®ã€‚
		 * æœ¯è¯­ï¼šé¡µç ã€æ¯é¡µæ˜¾ç¤ºæ¡ç›®ã€æ•°æ®æ€»æ•°ã€æ¯é¡µæ•°æ®åˆ—è¡¨
		 * å…¶ä¸­æ¯é¡µæ˜¾ç¤ºæ¡ç›®æ˜¯åŠ¨æ€çš„ï¼ˆæš‚å®š5æ¡ï¼‰
		 * æ•°æ®æ€»æ•°æ˜¯æ¥å£æä¾›çš„ã€‚é¡µç æ•°éœ€è¦æ ¹æ®æ•°æ®æ€»æ•°å’Œæ¯é¡µæ˜¾ç¤ºçš„æ¡ç›®æ•°å»è®¡ç®—çš„
		 * æ€»é¡µç æ•° = æ€»æ•°æ®æ¡æ•° / æ¯é¡µæ•°æ®æ¡æ•°
		 * ï¼Ÿ =  28 / 5
		 */
		// ä¸ºäº†å…¨å±€ç¼“å­˜æ‰€æœ‰çš„æ•°æ®
		var personsList = null
		// å…¨å±€ç¼“å­˜æ•°æ®æ€»æ¡æ•°
		var totalCount = 0
		// å½“å‰é¡µç 
		var currentPageNo = 1
		// ä»»åŠ¡1ï¼šè®¡ç®—æœ‰å¤šå°‘é¡µ(ä»¥ä¾¿åˆå§‹åŒ–æŒ‰é’®)
		function initBtn(){
			// é€šè¿‡jQçš„getJSONæ–¹æ³•è·å–æ•°æ®
			// å‚æ•°2ï¼šæ˜¯è¿åŒè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼Œnullå³æ— 
			$.getJSON("data.json", null, function(resultData){
				// resultDataæ˜¯è§£æå‡ºæ¥çš„Jsonå¯¹è±¡
				//console.log(resultData)
				
				/**
				 * æŠŠè·å–åˆ°çš„æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°ï¼špersonså’ŒtotalCount
				 */
				personsList = resultData.persons
				totalCount = resultData.totalCount
				// åŠ¨æ€æ·»åŠ ã€å…±XXé¡µã€‘æŒ‰é’®
				var $all = $('<a href="###" style="width:80px">' + 'å…±' + Math.ceil(totalCount / 5) + 'é¡µ' + '</a>')
				$('.prev').after($all)
				//====================
				// åŒ…è£…
				var obj = {
					count: Math.ceil(totalCount / 5)
				}
				// ä½¿ç”¨ç™¾åº¦æ¨¡æ¿
				// ç™¾åº¦æ¨¡æ¿æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ¥å£
				var str = baidu.template('pageBtns_tpl', obj)
				//====================
				// å°†strè¿½åŠ åˆ°prevå…ƒç´ ä¹‹å
				$('.prev').after(str)
				// ç»™æ‰€æœ‰çš„æŒ‰é’®ç»‘å®šäº‹ä»¶
				$('.fenye a').on('click', fenyeFn)
				// é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€é¡µçš„æ•°æ®
				showData(currentPageNo)
			})
		}
		// å‡½æ•°è°ƒç”¨
		initBtn()
		
		// æ„å»ºæŸä¸€é¡µçš„æ•°æ®  pageNo = 3
		function showData(pageNo){
			/**
			 * ç¬¬1é¡µï¼š0--4
			 * ç¬¬2é¡µï¼š5--9
			 * ç¬¬3é¡µï¼š10--14
			 * ç¬¬4é¡µï¼š15--19
			 * ç¬¬5é¡µï¼š20--22
			 */
			// arrayObject.slice(start, end)æ–¹æ³•å¯ä»¥ä»å·²æœ‰çš„æ•°ç»„ä¸­è¿”å›é€‰å®šçš„å…ƒç´ ,è¿”å›ä¸€ä¸ªæ–°çš„
			//æ•°ç»„ï¼ŒåŒ…å«ä»startåˆ°end(ä¸åŒ…æ‹¬è¯¥å…ƒç´ )çš„arrayObjectä¸­çš„å…ƒç´ 
			// currentArræ•°ç»„çš„æ¯ä¸ªå…ƒç´ tempPersonä»£è¡¨ä¸€ä¸ªäººçš„ä¿¡æ¯
			var currentArr = personsList.slice((pageNo - 1) * 5, pageNo * 5)
			console.log(currentArr)
			
			/**
			 * ã€æ³¨æ„ã€‘ä½¿ç”¨ç™¾åº¦æ¨¡æ¿
			 * è¿™ä¸ªbaidu.template()æ–¹æ³•æœ‰2ä¸ªå‚æ•°ï¼š
			 * å‚æ•°1ï¼šæ˜¯å®šä¹‰å¥½çš„æ¨¡æ¿idï¼šperson_tpl
			 * å‚æ•°2ï¼šè¦ä¼ å…¥éå†çš„æ•°æ®(æ³¨æ„ï¼šè¿™ä¸ªå‚æ•°å¾ˆç‰¹åˆ«ï¼Œä¸èƒ½ç›´æ¥ä¼ åŸç”Ÿæ•°æ®)
			 * éœ€è¦ä¼ å…¥çš„åŸç”Ÿæ•°æ®ç”¨ä¸€ä¸ªå¯¹è±¡åŒ…èµ·æ¥ï¼Œæ¢å¥è¯è¯´ï¼Œä¼ å…¥çš„å¿…é¡»æ˜¯åŒ…è£…å¥½åçš„å¯¹è±¡
			 * æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼šè¿”å›å€¼å°±æ˜¯ç”Ÿæˆå¥½çš„htmlå­—ç¬¦ä¸²
			 */
			// åŒ…è£…
			var obj = {
				arr: currentArr
			}
			// è°ƒç”¨ç™¾åº¦æ¨¡æ¿æ–¹æ³•:è¿”å›ç”Ÿæˆå¥½çš„htmlæ ‡ç­¾çš„å­—ç¬¦ä¸²
			var str = baidu.template('person_tpl', obj)
			
			// æŠŠ$strä½œä¸ºtbodyçš„html
			$('tbody').html(str)
		}
		// ä»»åŠ¡2ï¼šåˆ†é¡µæŒ‰é’®ç‚¹å‡»é€»è¾‘
		function fenyeFn(){
			// å¾—åˆ°å…ƒç´ çš„htmlçš„å€¼
			//console.log("æŒ‰é’®ä¸Šçš„æ–‡å­—æ˜¯ï¼š" + $(this).html())
			// 1ã€å¤„ç†é¡µç æ•°çš„é€»è¾‘ï¼šç‚¹å‡»åï¼ŒcurrentPageNoçš„å€¼è¢«æ”¹å˜äº†
			switch($(this).html()){
				case 'é¦–é¡µ':
					currentPageNo = 1
					break
				case '&lt;&lt;ä¸Šä¸€é¡µ':
					currentPageNo--
					break
				case 'ä¸‹ä¸€é¡µ&gt;&gt;':
					currentPageNo++
					break
				case 'å°¾é¡µ':
					currentPageNo = Math.ceil(totalCount / 5)
					break
				default:
					currentPageNo = parseInt($(this).html())
					break
			}
			console.log("å½“å‰é¡µæ˜¯ï¼š" + currentPageNo)
			//===========================
			//2ã€é¦–å°¾ã€ä¸Šä¸‹æŒ‰é’®çš„éšè—æ˜¾ç¤ºé€»è¾‘
			if(currentPageNo == 1){
				$('.start').css('display', 'none')
				$('.prev').css('display', 'none')
			}else{
				$('.start').css('display', 'inline-block')
				$('.prev').css('display', 'inline-block')
			}
			// å¦‚æœæ˜¯æœ€åä¸€é¡µ
			if(currentPageNo == Math.ceil(totalCount / 5)){
				$('.end').css('display', 'none')
				$('.next').css('display', 'none')
			}else{
				$('.end').css('display', 'inline-block')
				$('.next').css('display', 'inline-block')
			}
			// 3ã€å¤„ç†æŒ‰é’®é¢œè‰²çš„é€»è¾‘
			//è·å–å…¨éƒ¨é¡µç æŒ‰é’®çš„æ•°ç»„
			var $pageBtn = $('[name=p]')
			//å…ˆæŠŠè¿™å‡ ä¸ªæŒ‰é’®çš„æ ·å¼è¿˜åŸæˆé»˜è®¤
			$pageBtn.css({
				background: "pink",
				color: "#999"
			})
			// ç„¶åå†å¤„ç†å½“å‰é¡µç æ•°å¯¹åº”çš„æŒ‰é’®æ ·å¼
			$pageBtn[currentPageNo - 1].style.background = 'orange'
			$pageBtn[currentPageNo - 1].style.color = '#fff'
			// åˆ·æ–°æ•°æ®
			showData(currentPageNo)
		}
	</script>
</html>
