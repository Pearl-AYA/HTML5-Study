<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>æ–‡ä»¶ä¸Šä¼ </title>
		<style type="text/css">
			*{
				padding: 0;
				margin: 0;
			}
		</style>
	</head>
	<body>
		<!--ã€ğŸ·ã€‘multipleå±æ€§è¡¨ç¤ºå¯æ”¯æŒä¸Šä¼ å¤šä¸ªæ–‡ä»¶-->
		æ–‡ä»¶ä¸Šä¼ ï¼š<input type="file" multiple="multiple"/>
		<ol></ol>
	</body>
	<script type="text/javascript">
		// ã€å±æ€§é€‰æ‹©å™¨ã€‘input[type=file]
		var inputFile = document.querySelector("input[type=file]")
		//console.log(inputFile)
		
		// ä¸€æ—¦æ£€æµ‹åˆ°changeäº‹ä»¶åˆ™æ‰§è¡Œåé¢çš„å‡½æ•°
		inputFile.onchange = function(){
			//console.log(this.files)
			// filesæ˜¯fileå…ƒç´ çš„å±æ€§ï¼Œthis.filesæ˜¯FileListå¯¹è±¡
			
			//å¯ä»¥åˆ©ç”¨ã€æ•°ç»„çš„sliceæ–¹æ³•ã€‘å°†å«æœ‰lengthå±æ€§çš„ç‰¹æ®Šå¯¹è±¡
			//å³FileListå¯¹è±¡è½¬åŒ–æˆæ•°ç»„
			var fileArr = Array.prototype.slice.call(this.files)
			//console.log(fileArr)
			//================
			//éå†æ•°ç»„
			for(var tempFile of fileArr){
				//æ•°ç»„é‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ ä¹Ÿæ˜¯å¯¹è±¡
				//console.log(tempFile);
				/**
				 * ã€ğŸ·ã€‘ä»¥ä¸Šè·å–çš„ä»…ä»…åªæ˜¯æ¯ä¸ªä¸Šä¼ æ–‡ä»¶å¯¹è±¡ï¼Œå¹¶ä¸èƒ½è·å¾—
				 * æ–‡ä»¶å†…éƒ¨çš„å†…å®¹ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡FileReaderå¯¹è±¡è¯»å–æ–‡ä»¶å¯¹è±¡
				 * çš„å†…å®¹ã€‚FileReaderå¯¹è±¡è¯»å–æ–‡ä»¶å†…å®¹çš„æ—¶å€™éœ€è¦ä¸€ä¸ªã€Blobå¯¹è±¡ã€‘
				 * ç»è¿‡è§‚å¯ŸFileå¯¹è±¡å°±æ˜¯Blobå¯¹è±¡
				 */
				(function(tempFile){
					var fileReader = new FileReader()
					/**
					 * ä¸¤ç§è¯»å–æ–¹å¼ï¼š
					 * æ–¹å¼1ï¼šï¸ä»¥æ–‡æœ¬å½¢å¼è¯»å–æ•°æ®éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šBlobå¯¹è±¡å’Œ
					 * è¯»å–æ—¶ç”¨çš„ç¼–ç æ ¼å¼   utf-8
					 * æ–¹å¼2ï¼šè¯»å–æ•°æ®ä»¥Base64çš„urlæ ¼å¼ï¼Œéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œå³Blobå¯¹è±¡
					 * è¿™é‡Œæ‰€è¯´çš„Blobå¯¹è±¡å³Fileå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„tempFileæ–‡ä»¶å¯¹è±¡
					 */
					fileReader.readAsDataURL(tempFile)
					// è¯»å–æ–‡ä»¶æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹ï¼Œä¼šè§¦å‘3ä¸ªäº‹ä»¶
					fileReader.onloadstart = function(){
						console.log("===========å¼€å§‹è¯»å–=========")
					}
					fileReader.onprogress = function(){
						console.log("=====è¯»å–è¿‡ç¨‹ä¸­æŒç»­è§¦å‘======")
					}
					fileReader.onloadend = function(){
						console.log("=====è¯»å–ç»“æŸçš„æ—¶å€™è§¦å‘=======")
						
						// è¿™ä¸ªthisè¡¨ç¤ºfileReaderï¼Œè€Œthis.resultè¡¨ç¤ºfileReaderè·å–åˆ°
						// çš„æ–‡ä»¶çš„å…¨éƒ¨æ•°æ®(åŒ…æ‹¬æ–‡ä»¶æœ¬èº«çš„ä¿¡æ¯å’Œæ–‡ä»¶çš„å†…å®¹ä¿¡æ¯)
						console.log(this.result)
						if(/^(image)/.test(tempFile.type)){
							// å¦‚æœæ˜¯å›¾ç‰‡ï¼Œæ·»åŠ åˆ°bodyä¸­
							var img = document.createElement("img")
							// å°†æ–‡ä»¶ç»™srcå±æ€§
							img.src = this.result
							// å°†imgè¿½åŠ ç»™body
							document.body.appendChild(img)
						}else{
							//å¦‚æœä¸æ˜¯å›¾ç‰‡ç±»å‹çš„æ–‡ä»¶ï¼Œåˆ™è¿½åŠ åˆ°olä¸­
							document.querySelector("ol").appendChild(createLi(tempFile))
						}
					}
				})(tempFile)
			}
		}
		//=====================
		// åˆ›å»ºLiçš„æ–¹æ³•
		function createLi(file){
			var li = document.createElement("li")
			// å¤„ç†æ–‡ä»¶åå­—
			var spanName = document.createElement("span")
			spanName.innerHTML = file.name
			//å°†spanNameè¿½åŠ ç»™li
			li.appendChild(spanName)
			//===============
			// å¤„ç†æ–‡ä»¶çš„å¤§å°(æ˜¾ç¤ºçš„å•ä½ä¸ºkb)
			 var spanSize = document.createElement("span")
			 //sizeçš„å•ä½æ˜¯byteï¼Œå³å­—èŠ‚  1024byte = 1kb
			 // toFixed(2)è¡¨ç¤ºä¿ç•™ä¸¤ä½å°æ•°
			 spanSize.innerHTML = (file.size / 1024).toFixed(2) + "kb"
			 //å°†spanSizeè¿½åŠ ç»™li
			 li.appendChild(spanSize)
			 //=================
			 //å¤„ç†æ—¶é—´(æˆ‘ä»¬è¦å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–)
			 var spanDate = document.createElement("span")
			 spanDate.innerHTML = getDateFormatToString(file.lastModifiedDate)
			 //å°†spanDateè¿½åŠ ç»™li
			 li.appendChild(spanDate)
			 return li
		}
		//=================
		// è‡ªå®šä¹‰æ—¥æœŸæ ¼å¼åŒ–å¤„ç†å‡½æ•°  2019-03-05
		function getDateFormatToString(date){
			return date.getFullYear() + "å¹´" + addZero(date.getMonth() + 1) + "æœˆ" +
			addZero(date.getDate()) + "æ—¥" +
			addZero(date.getHours()) + ":" + addZero(date.getMinutes()) + ":" + 
			addZero(date.getSeconds()) + " " + weekMap.get(date.getDay())
			// Mapé›†åˆçš„get()æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªã€é”®ã€‘å¾—åˆ°ã€å€¼ã€‘
		}
		// è¡¥é›¶å¤„ç†
		function addZero(num){
			return num >= 10 ? num : "0" + num;
		}
		// Mapé›†åˆ
		var weekMap = new Map([
			[0, 'æ˜ŸæœŸæ—¥'],
			[1, 'æ˜ŸæœŸä¸€'],
			[2, 'æ˜ŸæœŸäºŒ'],
			[3, 'æ˜ŸæœŸä¸‰'],
			[4, 'æ˜ŸæœŸå››'],
			[5, 'æ˜ŸæœŸäº”'],
			[6, 'æ˜ŸæœŸå…­']
		])
	</script>
</html>
